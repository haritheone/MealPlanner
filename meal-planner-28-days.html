<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Family Meal Planner - 28-Day Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fraunces:wght@400;600;700&family=DM+Sans:wght@400;500;600&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #059669; --primary-dark: #047857; --primary-light: #10b981;
            --accent: #f59e0b; --text-primary: #1e293b; --text-secondary: #64748b;
            --border: #e2e8f0; --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        body {
            font-family: 'DM Sans', sans-serif;
            background: linear-gradient(135deg, #fef3c7 0%, #d1fae5 50%, #bfdbfe 100%);
            min-height: 100vh; padding: 24px; color: var(--text-primary);
        }
        .container {
            max-width: 1000px; margin: 0 auto; background: white;
            border-radius: 24px; box-shadow: var(--shadow-lg); padding: 48px;
        }
        .header { text-align: center; margin-bottom: 48px; }
        .header-icon { font-size: 72px; margin-bottom: 16px; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .header h1 { font-family: 'Fraunces', serif; font-size: 42px; margin-bottom: 12px; font-weight: 700; }
        .header p { color: var(--text-secondary); font-size: 18px; }
        .ai-badge {
            display: inline-flex; align-items: center; gap: 8px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 600; margin-top: 16px;
        }
        .progress-bar { display: flex; justify-content: center; align-items: center; margin-bottom: 48px; gap: 12px; }
        .progress-step {
            width: 44px; height: 44px; border-radius: 50%; background: #e2e8f0; color: #94a3b8;
            display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 18px;
            transition: all 0.4s; position: relative;
        }
        .progress-step.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white; transform: scale(1.1); box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }
        .progress-step.completed { background: var(--primary); color: white; }
        .progress-step.completed::after { content: '‚úì'; position: absolute; font-size: 20px; }
        .progress-line { width: 48px; height: 4px; background: #e2e8f0; border-radius: 2px; transition: all 0.4s; }
        .progress-line.active { background: linear-gradient(90deg, var(--primary), var(--primary-light)); }
        .section { display: none; animation: fadeInUp 0.5s ease-out; }
        .section.active { display: block; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .section-title {
            text-align: center; font-family: 'Fraunces', serif; font-size: 32px; margin-bottom: 40px;
            display: flex; align-items: center; justify-content: center; gap: 16px;
        }
        .section-title-icon { font-size: 36px; }
        .cuisine-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .diet-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }
        .cuisine-card, .diet-card {
            padding: 32px; border: 3px solid var(--border); border-radius: 20px; text-align: center;
            cursor: pointer; transition: all 0.3s; background: white;
        }
        .cuisine-card:hover, .diet-card:hover {
            transform: translateY(-8px); border-color: var(--primary-light);
            box-shadow: 0 12px 24px rgba(5, 150, 105, 0.15);
        }
        .cuisine-card.selected, .diet-card.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white; transform: scale(1.05); box-shadow: 0 12px 32px rgba(5, 150, 105, 0.3);
        }
        .cuisine-emoji, .diet-icon { font-size: 64px; margin-bottom: 16px; }
        .cuisine-name, .diet-name {
            font-size: 20px; font-weight: 600; font-family: 'Fraunces', serif;
            color: var(--text-primary);
        }
        .cuisine-card.selected .cuisine-name, .diet-card.selected .diet-name { color: white; }
        .diet-desc { font-size: 14px; color: #64748b; margin-top: 8px; }
        .diet-card.selected .diet-desc { color: rgba(255, 255, 255, 0.9); }
        .age-group-list { display: flex; flex-direction: column; gap: 16px; margin-bottom: 32px; }
        .age-group-card {
            padding: 28px; border: 3px solid var(--border); border-radius: 20px; cursor: pointer;
            transition: all 0.3s; display: flex; align-items: center; gap: 24px; background: white;
        }
        .age-group-card:hover {
            border-color: var(--primary-light); transform: translateX(8px);
            box-shadow: 0 8px 20px rgba(5, 150, 105, 0.1);
        }
        .age-group-card.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white; box-shadow: 0 12px 32px rgba(5, 150, 105, 0.3);
        }
        .age-group-card.selected .age-description { color: rgba(255, 255, 255, 0.9); }
        .age-icon { font-size: 56px; }
        .age-content { flex: 1; }
        .age-title { font-size: 22px; font-weight: 600; font-family: 'Fraunces', serif; margin-bottom: 6px; }
        .age-description { font-size: 15px; color: var(--text-secondary); }
        .days-selector {
            background: linear-gradient(135deg, #ecfdf5, #f0fdf4);
            padding: 40px; border-radius: 20px; margin-bottom: 32px; border: 2px solid #a7f3d0;
        }
        .days-label {
            font-size: 20px; font-weight: 600; margin-bottom: 24px; text-align: center; font-family: 'Fraunces', serif;
        }
        .days-value { color: var(--primary); font-weight: 700; font-size: 32px; }
        .slider-container { margin: 28px 0; }
        .slider {
            width: 100%; height: 8px; border-radius: 4px; background: #d1fae5;
            outline: none; appearance: none; cursor: pointer;
        }
        .slider::-webkit-slider-thumb {
            appearance: none; width: 32px; height: 32px; border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            cursor: pointer; box-shadow: 0 4px 12px rgba(5, 150, 105, 0.4); transition: transform 0.2s;
        }
        .slider::-webkit-slider-thumb:hover { transform: scale(1.2); }
        .slider::-moz-range-thumb {
            width: 32px; height: 32px; border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            cursor: pointer; border: none; box-shadow: 0 4px 12px rgba(5, 150, 105, 0.4);
        }
        .slider-labels { display: flex; justify-content: space-between; font-size: 14px; color: var(--text-secondary); margin-top: 12px; font-weight: 500; }
        .button-group { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
        .btn {
            padding: 18px 36px; border: none; border-radius: 16px; font-size: 17px; font-weight: 600;
            cursor: pointer; transition: all 0.3s; font-family: 'DM Sans', sans-serif;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white; box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(5, 150, 105, 0.4); }
        .btn-secondary { background: #f1f5f9; color: var(--text-primary); }
        .btn-secondary:hover { background: #e2e8f0; }
        .btn-full { grid-column: 1 / -1; }
        .loading { text-align: center; padding: 60px 20px; }
        .spinner {
            width: 60px; height: 60px; border: 4px solid #e2e8f0; border-top-color: var(--primary);
            border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 24px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 18px; color: var(--text-secondary); margin-bottom: 8px; }
        .loading-subtext { font-size: 14px; color: var(--text-secondary); }
        .meal-plan-container {
            max-height: 600px; overflow-y: auto; padding-right: 12px; margin-bottom: 32px;
        }
        .meal-plan-container::-webkit-scrollbar { width: 10px; }
        .meal-plan-container::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 5px; }
        .meal-plan-container::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--primary), var(--primary-light)); border-radius: 5px;
        }
        .plan-summary {
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
            padding: 32px; border-radius: 20px; margin-bottom: 32px; text-align: center; border: 2px solid #a7f3d0;
        }
        .plan-summary h3 { font-family: 'Fraunces', serif; font-size: 28px; margin-bottom: 12px; }
        .plan-summary p { color: var(--text-secondary); font-size: 16px; margin-bottom: 8px; }
        .source-badge {
            display: inline-flex; align-items: center; gap: 6px; background: white;
            padding: 6px 14px; border-radius: 12px; font-size: 13px; color: var(--primary); font-weight: 600; margin-top: 12px;
        }
        .day-card {
            background: white; padding: 32px; border-radius: 20px; border: 2px solid var(--border);
            margin-bottom: 20px; transition: all 0.3s;
        }
        .day-card:hover { box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08); border-color: var(--primary-light); }
        .day-title {
            font-family: 'Fraunces', serif; font-size: 24px; font-weight: 700; color: var(--primary);
            margin-bottom: 24px; display: flex; align-items: center; gap: 12px;
        }
        .meal-grid { display: grid; gap: 16px; }
        .meal-item {
            background: linear-gradient(135deg, #fefefe, #f9fafb);
            padding: 20px; border-radius: 16px; border: 1px solid var(--border); transition: all 0.2s;
        }
        .meal-item:hover { border-color: var(--primary-light); transform: translateX(4px); }
        .meal-label {
            display: flex; align-items: center; gap: 10px; font-weight: 600;
            color: var(--text-primary); margin-bottom: 10px; font-size: 16px;
        }
        .meal-icon { font-size: 20px; }
        .meal-description { color: var(--text-secondary); margin-left: 30px; line-height: 1.6; font-size: 15px; }
        .meal-source { font-size: 12px; color: var(--primary); margin-left: 30px; margin-top: 6px; font-style: italic; }
        .shopping-list {
            background: white; padding: 32px; border-radius: 20px; border: 2px solid var(--border); margin-top: 24px;
        }
        .shopping-list h3 {
            font-family: 'Fraunces', serif; font-size: 24px; margin-bottom: 20px;
            display: flex; align-items: center; gap: 12px;
        }
        .shopping-category { margin-bottom: 24px; }
        .category-title {
            font-weight: 600; color: var(--primary); margin-bottom: 12px; font-size: 18px;
            display: flex; align-items: center; gap: 8px;
        }
        .shopping-items { display: grid; gap: 8px; }
        .shopping-item {
            display: flex; align-items: center; gap: 12px; padding: 12px;
            background: #f9fafb; border-radius: 12px; transition: all 0.2s;
        }
        .shopping-item:hover { background: #f1f5f9; }
        .shopping-checkbox {
            width: 20px; height: 20px; border-radius: 6px; border: 2px solid var(--border);
            cursor: pointer; transition: all 0.2s;
        }
        .shopping-checkbox.checked { background: var(--primary); border-color: var(--primary); position: relative; }
        .shopping-checkbox.checked::after {
            content: '‚úì'; color: white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 14px;
        }
        .shopping-item-text { flex: 1; color: var(--text-primary); }
        .shopping-item.checked .shopping-item-text { text-decoration: line-through; color: var(--text-secondary); }
        .action-buttons { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 24px; }
        .action-buttons button:last-child { grid-column: 1 / -1; }
        .btn-icon { display: inline-flex; align-items: center; gap: 8px; }
        
        .calendar-header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .calendar-header h3 {
            font-family: 'Fraunces', serif;
            font-size: 28px;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .calendar-day {
            background: white;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 12px;
            min-height: 200px;
            transition: all 0.3s;
        }
        
        .calendar-day:hover {
            border-color: var(--primary-light);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.1);
        }
        
        .calendar-day-header {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 14px;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 4px;
        }
        
        .calendar-meal {
            font-size: 11px;
            margin: 6px 0;
            padding: 4px;
            background: #f9fafb;
            border-radius: 6px;
        }
        
        .calendar-meal-type {
            font-weight: 600;
            color: var(--primary);
            display: block;
            margin-bottom: 2px;
        }
        
        .swap-meal-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 8px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .swap-meal-btn:hover {
            background: var(--accent-dark);
            transform: translateY(-2px);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 32px;
            border-radius: 20px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            font-family: 'Fraunces', serif;
            font-size: 24px;
            margin-bottom: 16px;
            color: var(--text-primary);
        }
        
        .modal-close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: var(--text-secondary);
        }
        
        .modal-close:hover {
            color: var(--text-primary);
        }
        
        .meal-option {
            padding: 16px;
            margin: 12px 0;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .meal-option:hover {
            border-color: var(--primary);
            background: #f0fdf4;
        }
        
        .meal-option-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .meal-option-info {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .try-recipes-banner {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 32px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 32px;
            border: 2px solid #fbbf24;
        }
        
        .try-recipes-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }
        
        .try-recipes-banner h3 {
            font-family: 'Fraunces', serif;
            font-size: 24px;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .try-recipes-banner p {
            color: var(--text-secondary);
            margin-bottom: 16px;
        }
        
        .recipe-form {
            text-align: left;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'DM Sans', sans-serif;
            font-size: 15px;
            transition: border-color 0.2s;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .recipe-suggestions {
            margin-top: 24px;
        }
        
        .recipe-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s;
        }
        
        .recipe-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.1);
        }
        
        .recipe-card-header {
            font-family: 'Fraunces', serif;
            font-size: 20px;
            color: var(--primary);
            margin-bottom: 12px;
        }
        
        .recipe-card-content {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 12px;
        }
        
        .recipe-card-actions {
            display: flex;
            gap: 12px;
        }
        
        .add-recipe-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .add-recipe-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .add-recipe-btn.added {
            background: #6b7280;
            cursor: not-allowed;
        }
        
        .success-message {
            background: #d1fae5;
            border: 2px solid #a7f3d0;
            color: #065f46;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            text-align: center;
        }
        
        .gcal-info {
            background: #f0fdf4;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #bbf7d0;
        }
        
        .gcal-buttons {
            margin-top: 20px;
        }
        
        .gcal-day-btn {
            background: white;
            border: 2px solid var(--border);
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            display: block;
            width: 100%;
            font-family: 'DM Sans', sans-serif;
        }
        
        .gcal-day-btn:hover {
            border-color: var(--primary);
            background: #f0fdf4;
            transform: translateX(4px);
        }
        
        .gcal-day-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 4px;
        }
        
        .gcal-day-meals {
            font-size: 13px;
            color: var(--text-secondary);
        }
        @media (max-width: 768px) {
            .container { padding: 32px 24px; }
            .header h1 { font-size: 32px; }
            .cuisine-grid { grid-template-columns: 1fr; }
            .diet-grid { grid-template-columns: 1fr; }
            .button-group { grid-template-columns: 1fr; }
            .progress-step { width: 32px; height: 32px; font-size: 14px; }
            .progress-line { width: 32px; }
            .action-buttons { flex-direction: column; }
        }
        .unique-badge {
            display: inline-block; background: #fef3c7; color: #92400e;
            padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; margin-left: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-icon">ü•ó</div>
            <h1>AI-Powered Meal Planner</h1>
            <p>28 unique recipes per meal type - Never repeat a meal!<span class="unique-badge">NEW: Mixed Diet Option</span></p>
            <div class="ai-badge"><span>‚ú®</span><span>Professional Health Data</span></div>
        </div>

        <div class="progress-bar">
            <div class="progress-step active" id="step1">1</div>
            <div class="progress-line" id="line1"></div>
            <div class="progress-step" id="step2">2</div>
            <div class="progress-line" id="line2"></div>
            <div class="progress-step" id="step3">3</div>
            <div class="progress-line" id="line3"></div>
            <div class="progress-step" id="step4">4</div>
            <div class="progress-line" id="line4"></div>
            <div class="progress-step" id="step5">5</div>
        </div>

        <!-- Step 1: Choose Cuisine -->
        <div class="section active" id="section1">
            <h2 class="section-title"><span class="section-title-icon">üåç</span>Choose Your Cuisine</h2>
            <div class="cuisine-grid">
                <div class="cuisine-card" data-cuisine="indian">
                    <div class="cuisine-emoji">üçõ</div>
                    <div class="cuisine-name">Indian</div>
                </div>
                <div class="cuisine-card" data-cuisine="mexican">
                    <div class="cuisine-emoji">üåÆ</div>
                    <div class="cuisine-name">Mexican</div>
                </div>
                <div class="cuisine-card" data-cuisine="italian">
                    <div class="cuisine-emoji">üçù</div>
                    <div class="cuisine-name">Italian</div>
                </div>
                <div class="cuisine-card" data-cuisine="american">
                    <div class="cuisine-emoji">üçî</div>
                    <div class="cuisine-name">American</div>
                </div>
            </div>
        </div>

        <!-- Step 2: Choose Diet Preference -->
        <div class="section" id="section2">
            <h2 class="section-title"><span class="section-title-icon">ü•ó</span>Choose Your Diet Preference</h2>
            <div class="diet-grid">
                <div class="diet-card" data-diet="vegetarian">
                    <div class="diet-icon">üå±</div>
                    <div class="diet-name">Vegetarian</div>
                    <div class="diet-desc">Plant-based with dairy & eggs</div>
                </div>
                <div class="diet-card" data-diet="meat">
                    <div class="diet-icon">üçó</div>
                    <div class="diet-name">Meat-Based</div>
                    <div class="diet-desc">Chicken, fish & goat only</div>
                </div>
                <div class="diet-card" data-diet="both">
                    <div class="diet-icon">ü•ô</div>
                    <div class="diet-name">Both (Mixed)</div>
                    <div class="diet-desc">Variety of both options</div>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep(1)">Back</button>
            </div>
        </div>

        <!-- Step 3: Choose Age Group -->
        <div class="section" id="section3">
            <h2 class="section-title"><span class="section-title-icon">üë•</span>Who is this plan for?</h2>
            <div class="age-group-list">
                <div class="age-group-card" data-age="children">
                    <div class="age-icon">üëßüë¶</div>
                    <div class="age-content">
                        <div class="age-title">Children (4-12 years)</div>
                        <div class="age-description">Balanced nutrition for growing kids - 1,400-2,000 cal/day</div>
                    </div>
                </div>
                <div class="age-group-card" data-age="women">
                    <div class="age-icon">üë©</div>
                    <div class="age-content">
                        <div class="age-title">Women (30-45 years)</div>
                        <div class="age-description">Nutrient-rich meals for active women - 1,800-2,200 cal/day</div>
                    </div>
                </div>
                <div class="age-group-card" data-age="men">
                    <div class="age-icon">üë®</div>
                    <div class="age-content">
                        <div class="age-title">Men (35-50 years)</div>
                        <div class="age-description">Heart-healthy, balanced diet - 2,200-2,800 cal/day</div>
                    </div>
                </div>
                <div class="age-group-card" data-age="all">
                    <div class="age-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                    <div class="age-content">
                        <div class="age-title">All (Family Plan)</div>
                        <div class="age-description">Flexible portions for the whole family - 1,800-2,400 cal/day</div>
                    </div>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep(2)">Back</button>
            </div>
        </div>

        <!-- Step 4: Choose Days -->
        <div class="section" id="section4">
            <h2 class="section-title"><span class="section-title-icon">üìÖ</span>How many days?</h2>
            <div class="days-selector">
                <div class="days-label">Plan Duration: <span class="days-value" id="daysValue">7</span> days</div>
                <div class="slider-container">
                    <input type="range" min="1" max="28" value="7" class="slider" id="daysSlider">
                    <div class="slider-labels"><span>1 day</span><span>28 days (4 weeks)</span></div>
                </div>
                <p style="text-align: center; margin-top: 16px; color: #64748b; font-size: 14px;">
                    ‚ú® Each meal is unique - no repeats for up to 28 days!
                </p>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep(3)">Back</button>
                <button class="btn btn-primary" onclick="generatePlan()">
                    <span class="btn-icon"><span>‚ú®</span><span>Generate AI Plan</span></span>
                </button>
            </div>
        </div>

        <!-- Step 5: Show Plan -->
        <div class="section" id="section5">
            <div id="loadingContainer" class="loading" style="display: none;">
                <div class="spinner"></div>
                <div class="loading-text">Generating your personalized meal plan...</div>
                <div class="loading-subtext">Creating 28 unique recipes from professional nutritionists</div>
            </div>

            <div id="planContent" style="display: none;">
                <div class="plan-summary" id="planSummary"></div>
                <div class="meal-plan-container" id="mealPlanContainer"></div>
                <div class="shopping-list" id="shoppingList"></div>
                
                <!-- Try New Recipes Banner (after meal plan) -->
                <div class="try-recipes-banner" style="margin-top: 32px;">
                    <div class="try-recipes-icon">‚ú®</div>
                    <h3>Want to try something new?</h3>
                    <p>Get AI-powered recipe suggestions to expand your meal plan</p>
                    <button class="btn btn-primary" onclick="showRecipeSuggester()">
                        <span class="btn-icon"><span>üç¥</span><span>Try New Recipes</span></span>
                    </button>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="toggleCalendarView()">
                        <span class="btn-icon"><span>üìÖ</span><span id="calendarToggleText">Show Calendar View</span></span>
                    </button>
                    <button class="btn btn-primary" onclick="downloadCalendar()">
                        <span class="btn-icon"><span>üì•</span><span>Download Calendar PDF</span></span>
                    </button>
                    <button class="btn btn-primary" onclick="exportToGoogleCalendar()">
                        <span class="btn-icon"><span>üìÜ</span><span>Add to Google Calendar</span></span>
                    </button>
                    <button class="btn btn-primary" onclick="downloadShoppingList()">
                        <span class="btn-icon"><span>üõí</span><span>Download Shopping List</span></span>
                    </button>
                    <button class="btn btn-secondary" onclick="resetPlanner()">
                        <span class="btn-icon"><span>üîÑ</span><span>Create New Plan</span></span>
                    </button>
                </div>
                
                <!-- Calendar View Container -->
                <div id="calendarViewContainer" style="display: none; margin-top: 32px;">
                    <div class="calendar-header">
                        <h3>üìÖ Calendar View</h3>
                        <p>Your meal plan in calendar format</p>
                    </div>
                    <div id="calendarGrid" class="calendar-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Meal Swap Modal -->
    <div id="swapModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeSwapModal()">&times;</span>
            <h2 class="modal-header">Choose a Different Meal</h2>
            <div id="swapOptions"></div>
        </div>
    </div>
    
    <!-- Recipe Suggester Modal -->
    <div id="recipeSuggesterModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeRecipeSuggester()">&times;</span>
            <h2 class="modal-header">‚ú® Try New Recipes</h2>
            <div id="recipeSuggesterContent">
                <div class="recipe-form">
                    <div class="form-group">
                        <label class="form-label">Choose Cuisine:</label>
                        <select id="recipeCuisine" class="form-select">
                            <option value="">Select cuisine...</option>
                            <option value="indian">Indian</option>
                            <option value="mexican">Mexican</option>
                            <option value="italian">Italian</option>
                            <option value="american">American</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Meal Type:</label>
                        <select id="recipeMealType" class="form-select">
                            <option value="">Select meal type...</option>
                            <option value="breakfast">Breakfast</option>
                            <option value="lunch">Lunch</option>
                            <option value="dinner">Dinner</option>
                            <option value="snack">Snack</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dietary Preference:</label>
                        <select id="recipeDiet" class="form-select">
                            <option value="">Select diet...</option>
                            <option value="vegetarian">Vegetarian</option>
                            <option value="meat">Meat-Based</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">What ingredients or flavors do you enjoy?</label>
                        <textarea id="recipePreferences" class="form-textarea" placeholder="e.g., avocado, spicy, mediterranean flavors, etc."></textarea>
                    </div>
                    <button class="btn btn-primary btn-full" onclick="generateRecipeSuggestions()">
                        <span class="btn-icon"><span>‚ú®</span><span>Generate Recipe Ideas</span></span>
                    </button>
                </div>
                <div id="recipeSuggestions" class="recipe-suggestions"></div>
            </div>
        </div>
    </div>
    
    <!-- Google Calendar Export Modal -->
    <div id="googleCalendarModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeGoogleCalendarModal()">&times;</span>
            <h2 class="modal-header">üìÜ Export to Google Calendar</h2>
            <div id="googleCalendarContent">
                <div class="gcal-info">
                    <p style="margin-bottom: 16px; color: #64748b;">
                        Add your meal plan to Google Calendar. Choose how you'd like to export:
                    </p>
                    
                    <div class="form-group">
                        <label class="form-label">Start Date:</label>
                        <input type="date" id="gcalStartDate" class="form-input" />
                        <p style="font-size: 13px; color: #64748b; margin-top: 4px;">
                            Your meal plan will start from this date
                        </p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Meal Times:</label>
                        <div style="display: grid; gap: 12px; margin-top: 8px;">
                            <div>
                                <label style="font-size: 14px; color: #64748b;">üåÖ Breakfast Time:</label>
                                <input type="time" id="breakfastTime" class="form-input" value="07:00" />
                            </div>
                            <div>
                                <label style="font-size: 14px; color: #64748b;">üçΩÔ∏è Lunch Time:</label>
                                <input type="time" id="lunchTime" class="form-input" value="12:00" />
                            </div>
                            <div>
                                <label style="font-size: 14px; color: #64748b;">üåô Dinner Time:</label>
                                <input type="time" id="dinnerTime" class="form-input" value="18:00" />
                            </div>
                            <div>
                                <label style="font-size: 14px; color: #64748b;">ü•§ Snack Time:</label>
                                <input type="time" id="snackTime" class="form-input" value="15:00" />
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Event Duration:</label>
                        <select id="eventDuration" class="form-select">
                            <option value="30">30 minutes</option>
                            <option value="60" selected>1 hour</option>
                            <option value="90">1.5 hours</option>
                            <option value="120">2 hours</option>
                        </select>
                    </div>
                    
                    <div class="gcal-buttons">
                        <button class="btn btn-primary btn-full" onclick="generateGoogleCalendarLinks()">
                            <span class="btn-icon"><span>üìÜ</span><span>Generate Calendar Events</span></span>
                        </button>
                        <button class="btn btn-secondary btn-full" onclick="createICSFile()" style="margin-top: 12px;">
                            <span class="btn-icon"><span>üì•</span><span>Download ICS File</span></span>
                        </button>
                        <p style="font-size: 12px; color: #64748b; margin-top: 8px; text-align: center;">
                            ICS file works with Google Calendar, Apple Calendar, Outlook, and more
                        </p>
                    </div>
                </div>
                
                <div id="gcalLinks" style="display: none; margin-top: 24px;">
                    <div class="success-message" style="margin-bottom: 16px;">
                        ‚úÖ Calendar events ready! Click the buttons below to add to Google Calendar.
                    </div>
                    <p style="font-size: 13px; color: #64748b; margin-bottom: 16px;">
                        Each button opens a new tab to add that day's meals to your Google Calendar. 
                        You'll need to be signed in to Google.
                    </p>
                    <div id="gcalLinkButtons" style="display: grid; gap: 8px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let state = { cuisine: '', diet: '', ageGroup: '', days: 7, currentStep: 1, mealPlan: null, shoppingList: {} };

        document.addEventListener('DOMContentLoaded', setupEventListeners);

        function setupEventListeners() {
            document.querySelectorAll('.cuisine-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.cuisine-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    state.cuisine = this.dataset.cuisine;
                    setTimeout(() => goToStep(2), 300);
                });
            });

            document.querySelectorAll('.diet-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.diet-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    state.diet = this.dataset.diet;
                    setTimeout(() => goToStep(3), 300);
                });
            });

            document.querySelectorAll('.age-group-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.age-group-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    state.ageGroup = this.dataset.age;
                    setTimeout(() => goToStep(4), 300);
                });
            });

            const slider = document.getElementById('daysSlider');
            slider.addEventListener('input', function() {
                state.days = parseInt(this.value);
                document.getElementById('daysValue').textContent = this.value;
            });
        }

        function goToStep(step) {
            state.currentStep = step;
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('section' + step).classList.add('active');
            
            for (let i = 1; i <= 5; i++) {
                const stepEl = document.getElementById('step' + i);
                stepEl.classList.remove('active', 'completed');
                if (i < step) stepEl.classList.add('completed');
                else if (i === step) stepEl.classList.add('active');
                
                if (i < 5) {
                    const lineEl = document.getElementById('line' + i);
                    if (i < step) lineEl.classList.add('active');
                    else lineEl.classList.remove('active');
                }
            }
        }

        async function generatePlan() {
            goToStep(5);
            document.getElementById('loadingContainer').style.display = 'block';
            document.getElementById('planContent').style.display = 'none';

            await new Promise(resolve => setTimeout(resolve, 2000));
            const mealPlan = await fetchProfessionalMealPlan();
            state.mealPlan = mealPlan;
            state.allRecipes = mealPlan.allRecipes; // Store all recipes for swapping
            generateShoppingList(mealPlan);
            displayMealPlan(mealPlan);
            
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('planContent').style.display = 'block';
        }

        async function fetchProfessionalMealPlan() {
            const sources = {
                indian: "Indian Dietetic Association",
                mexican: "Latino Nutrition Coalition",
                italian: "Mediterranean Diet Foundation",
                american: "American Dietetic Association"
            };

            const guidelines = {
                children: { calories: "1,400-2,000 kcal/day", protein: "40-50g/day" },
                women: { calories: "1,800-2,200 kcal/day", protein: "46-56g/day" },
                men: { calories: "2,200-2,800 kcal/day", protein: "56-70g/day" },
                all: { calories: "1,800-2,400 kcal/day", protein: "50-60g/day" }
            };

            // Recipe generator function - creates 28 unique recipes dynamically
            const generateRecipes = (cuisine, diet, ageGroup) => {
                const recipes = {
                    indian: {
                        vegetarian: {
                            breakfast: generateBreakfastRecipes('Indian', 'Vegetarian', ageGroup),
                            lunch: generateLunchRecipes('Indian', 'Vegetarian', ageGroup),
                            dinner: generateDinnerRecipes('Indian', 'Vegetarian', ageGroup),
                            snacks: generateSnackRecipes('Indian', 'Vegetarian', ageGroup)
                        },
                        meat: {
                            breakfast: generateBreakfastRecipes('Indian', 'Meat', ageGroup),
                            lunch: generateLunchRecipes('Indian', 'Meat', ageGroup),
                            dinner: generateDinnerRecipes('Indian', 'Meat', ageGroup),
                            snacks: generateSnackRecipes('Indian', 'Meat', ageGroup)
                        },
                        both: {
                            breakfast: mixDietRecipes(
                                generateBreakfastRecipes('Indian', 'Vegetarian', ageGroup),
                                generateBreakfastRecipes('Indian', 'Meat', ageGroup)
                            ),
                            lunch: mixDietRecipes(
                                generateLunchRecipes('Indian', 'Vegetarian', ageGroup),
                                generateLunchRecipes('Indian', 'Meat', ageGroup)
                            ),
                            dinner: mixDietRecipes(
                                generateDinnerRecipes('Indian', 'Vegetarian', ageGroup),
                                generateDinnerRecipes('Indian', 'Meat', ageGroup)
                            ),
                            snacks: mixDietRecipes(
                                generateSnackRecipes('Indian', 'Vegetarian', ageGroup),
                                generateSnackRecipes('Indian', 'Meat', ageGroup)
                            )
                        }
                    },
                    mexican: {
                        vegetarian: {
                            breakfast: generateBreakfastRecipes('Mexican', 'Vegetarian', ageGroup),
                            lunch: generateLunchRecipes('Mexican', 'Vegetarian', ageGroup),
                            dinner: generateDinnerRecipes('Mexican', 'Vegetarian', ageGroup),
                            snacks: generateSnackRecipes('Mexican', 'Vegetarian', ageGroup)
                        },
                        meat: {
                            breakfast: generateBreakfastRecipes('Mexican', 'Meat', ageGroup),
                            lunch: generateLunchRecipes('Mexican', 'Meat', ageGroup),
                            dinner: generateDinnerRecipes('Mexican', 'Meat', ageGroup),
                            snacks: generateSnackRecipes('Mexican', 'Meat', ageGroup)
                        },
                        both: {
                            breakfast: mixDietRecipes(
                                generateBreakfastRecipes('Mexican', 'Vegetarian', ageGroup),
                                generateBreakfastRecipes('Mexican', 'Meat', ageGroup)
                            ),
                            lunch: mixDietRecipes(
                                generateLunchRecipes('Mexican', 'Vegetarian', ageGroup),
                                generateLunchRecipes('Mexican', 'Meat', ageGroup)
                            ),
                            dinner: mixDietRecipes(
                                generateDinnerRecipes('Mexican', 'Vegetarian', ageGroup),
                                generateDinnerRecipes('Mexican', 'Meat', ageGroup)
                            ),
                            snacks: mixDietRecipes(
                                generateSnackRecipes('Mexican', 'Vegetarian', ageGroup),
                                generateSnackRecipes('Mexican', 'Meat', ageGroup)
                            )
                        }
                    },
                    italian: {
                        vegetarian: {
                            breakfast: generateBreakfastRecipes('Italian', 'Vegetarian', ageGroup),
                            lunch: generateLunchRecipes('Italian', 'Vegetarian', ageGroup),
                            dinner: generateDinnerRecipes('Italian', 'Vegetarian', ageGroup),
                            snacks: generateSnackRecipes('Italian', 'Vegetarian', ageGroup)
                        },
                        meat: {
                            breakfast: generateBreakfastRecipes('Italian', 'Meat', ageGroup),
                            lunch: generateLunchRecipes('Italian', 'Meat', ageGroup),
                            dinner: generateDinnerRecipes('Italian', 'Meat', ageGroup),
                            snacks: generateSnackRecipes('Italian', 'Meat', ageGroup)
                        },
                        both: {
                            breakfast: mixDietRecipes(
                                generateBreakfastRecipes('Italian', 'Vegetarian', ageGroup),
                                generateBreakfastRecipes('Italian', 'Meat', ageGroup)
                            ),
                            lunch: mixDietRecipes(
                                generateLunchRecipes('Italian', 'Vegetarian', ageGroup),
                                generateLunchRecipes('Italian', 'Meat', ageGroup)
                            ),
                            dinner: mixDietRecipes(
                                generateDinnerRecipes('Italian', 'Vegetarian', ageGroup),
                                generateDinnerRecipes('Italian', 'Meat', ageGroup)
                            ),
                            snacks: mixDietRecipes(
                                generateSnackRecipes('Italian', 'Vegetarian', ageGroup),
                                generateSnackRecipes('Italian', 'Meat', ageGroup)
                            )
                        }
                    },
                    american: {
                        vegetarian: {
                            breakfast: generateBreakfastRecipes('American', 'Vegetarian', ageGroup),
                            lunch: generateLunchRecipes('American', 'Vegetarian', ageGroup),
                            dinner: generateDinnerRecipes('American', 'Vegetarian', ageGroup),
                            snacks: generateSnackRecipes('American', 'Vegetarian', ageGroup)
                        },
                        meat: {
                            breakfast: generateBreakfastRecipes('American', 'Meat', ageGroup),
                            lunch: generateLunchRecipes('American', 'Meat', ageGroup),
                            dinner: generateDinnerRecipes('American', 'Meat', ageGroup),
                            snacks: generateSnackRecipes('American', 'Meat', ageGroup)
                        },
                        both: {
                            breakfast: mixDietRecipes(
                                generateBreakfastRecipes('American', 'Vegetarian', ageGroup),
                                generateBreakfastRecipes('American', 'Meat', ageGroup)
                            ),
                            lunch: mixDietRecipes(
                                generateLunchRecipes('American', 'Vegetarian', ageGroup),
                                generateLunchRecipes('American', 'Meat', ageGroup)
                            ),
                            dinner: mixDietRecipes(
                                generateDinnerRecipes('American', 'Vegetarian', ageGroup),
                                generateDinnerRecipes('American', 'Meat', ageGroup)
                            ),
                            snacks: mixDietRecipes(
                                generateSnackRecipes('American', 'Vegetarian', ageGroup),
                                generateSnackRecipes('American', 'Meat', ageGroup)
                            )
                        }
                    }
                };

                return recipes[cuisine][diet];
            };
            
            // Helper function to mix vegetarian and meat recipes alternately
            function mixDietRecipes(vegRecipes, meatRecipes) {
                const mixed = [];
                const maxLength = Math.max(vegRecipes.length, meatRecipes.length);
                
                for (let i = 0; i < maxLength; i++) {
                    // Alternate: veg, meat, veg, meat, etc.
                    if (i < vegRecipes.length && i % 2 === 0) {
                        mixed.push(vegRecipes[i]);
                    }
                    if (i < meatRecipes.length && i % 2 === 1) {
                        mixed.push(meatRecipes[i]);
                    }
                }
                
                // Fill remaining slots
                while (mixed.length < 28) {
                    const useVeg = mixed.length % 2 === 0;
                    const sourceArray = useVeg ? vegRecipes : meatRecipes;
                    const index = mixed.length % sourceArray.length;
                    mixed.push(sourceArray[index]);
                }
                
                return mixed.slice(0, 28);
            }

            function generateBreakfastRecipes(cuisine, diet, ageGroup) {
                const calorieBase = ageGroup === 'children' ? 340 : (ageGroup === 'women' ? 370 : (ageGroup === 'men' ? 480 : 390));
                const proteinBase = ageGroup === 'children' ? 12 : (ageGroup === 'women' ? 16 : (ageGroup === 'men' ? 28 : 18));
                
                const vegBreakfasts = {
                    Indian: ['Idli with sambar and coconut chutney', 'Dosa with potato masala', 'Appam with vegetable stew', 'Upma with coconut', 'Pongal with sambar', 'Uttapam with tomato and onion', 'Rava dosa with chutney', 'Medu vada with sambar', 'Pesarattu with ginger chutney', 'Puttu with kadala curry', 'Idiyappam with coconut milk curry', 'Paniyaram with chutney', 'Adai with avial', 'Ven pongal with sambhar', 'Sweet pongal', 'Ragi dosa with chutney', 'Kuzhi paniyaram', 'Semiya upma', 'Tapioca with green gram curry', 'Kerala parotta with kurma', 'Poori with potato masala', 'Masala dosa', 'Onion rava dosa', 'Oats idli', 'Multigrain dosa', 'Set dosa with chutney', 'Vegetable uthappam', 'Nei dosa'],
                    Mexican: ['Bean and cheese burrito', 'Huevos rancheros', 'Chilaquiles', 'Breakfast tacos', 'Molletes', 'Pan dulce with fruit', 'Veggie quesadilla', 'Mexican omelet', 'Avocado toast Mexican style', 'Fruit salad with chili', 'Bean and egg wrap', 'Churro French toast', 'Mexican breakfast bowl', 'Nopal salad', 'Sweet corn cakes', 'Breakfast enchiladas', 'Tamales', 'Veggie torta', 'Mexican scramble', 'Breakfast tostada', 'Bean gorditas', 'Fruit smoothie bowl', 'Mexican frittata', 'Breakfast chimichanga', 'Veggie sopes', 'Mexican yogurt parfait', 'Breakfast flautas', 'Mexican crepes'],
                    Italian: ['Frittata', 'Ricotta toast', 'Yogurt with fruit', 'Whole grain toast with tomato', 'Smoothie with berries', 'Poached eggs', 'Oatmeal with nuts', 'Italian omelet', 'Breakfast focaccia', 'Biscotti with milk', 'Panettone with fruit', 'Italian yogurt bowl', 'Eggs with bruschetta', 'Breakfast polenta', 'Italian breakfast wrap', 'Cappuccino bowl', 'Breakfast piadina', 'Italian scramble', 'Breakfast crostini', 'Italian pancakes', 'Ricotta pancakes', 'Italian egg muffins', 'Breakfast cannoli', 'Italian granola', 'Breakfast ciabatta', 'Italian toast', 'Breakfast arancini', 'Italian smoothie'],
                    American: ['Whole grain pancakes', 'Veggie omelet', 'Oatmeal', 'French toast', 'Breakfast burrito', 'Yogurt parfait', 'Smoothie bowl', 'Waffles', 'Quesadilla', 'Overnight oats', 'Scrambled tofu', 'Bagel with cream cheese', 'Breakfast sandwich', 'Granola with milk', 'Chia pudding', 'Avocado toast', 'Protein pancakes', 'Cottage cheese bowl', 'Breakfast tacos', 'Fruit and nut bowl', 'Veggie hash', 'Breakfast pizza', 'Quinoa bowl', 'Breakfast wrap', 'Shakshuka', 'Muffins', 'Cereal bowl', 'English muffin sandwich']
                };
                
                const meatBreakfasts = {
                    Indian: ['Egg dosa with chutney', 'Egg appam with curry', 'Chicken keema with idli', 'Fish curry with dosa', 'Egg bhurji with parotta', 'Chicken curry with appam', 'Fish moilee with puttu', 'Egg roast with bread', 'Chicken chettinad with idli', 'Fish fry with dosa', 'Egg masala with parotta', 'Chicken varuval with rice', 'Fish curry Kerala style', 'Egg podimas with bread', 'Chicken pepper fry with dosa', 'Fish mappas with appam', 'Egg curry with idli', 'Chicken roast with parotta', 'Fish pollichathu with rice', 'Egg omelette with bread', 'Chicken stew with appam', 'Fish molly with puttu', 'Egg burji with dosa', 'Chicken varutharacha curry', 'Fish fry with tapioca', 'Egg masala with idiyappam', 'Chicken peratal', 'Fish curry with rice'],
                    Mexican: ['Huevos with chorizo', 'Chicken breakfast tacos', 'Fish breakfast burrito', 'Eggs with chicken', 'Chicken chilaquiles', 'Fish tacos breakfast', 'Chicken and egg wrap', 'Fish breakfast bowl', 'Chicken quesadilla', 'Eggs with goat', 'Fish breakfast taco', 'Chicken scramble', 'Breakfast burrito with chicken', 'Fish huevos rancheros', 'Chicken breakfast enchiladas', 'Fish and eggs Mexican', 'Chicken breakfast tostada', 'Fish breakfast quesadilla', 'Chicken and bean burrito', 'Fish breakfast wrap', 'Chicken breakfast bowl', 'Fish chilaquiles', 'Chicken breakfast torta', 'Fish breakfast scramble', 'Chicken breakfast chimichanga', 'Fish breakfast sopes', 'Chicken breakfast flautas', 'Fish breakfast gorditas'],
                    Italian: ['Eggs with Italian sausage (chicken)', 'Fish frittata', 'Chicken omelet Italian', 'Eggs with smoked fish', 'Chicken breakfast wrap', 'Fish and eggs', 'Chicken frittata', 'Fish breakfast sandwich', 'Chicken breakfast focaccia', 'Eggs with chicken', 'Fish breakfast bowl', 'Chicken scramble Italian', 'Fish and egg wrap', 'Chicken breakfast piadina', 'Fish frittata', 'Chicken breakfast crostini', 'Fish Italian scramble', 'Chicken breakfast polenta', 'Fish breakfast focaccia', 'Chicken egg sandwich', 'Fish breakfast wrap Italian', 'Chicken breakfast pizza', 'Fish and eggs toast', 'Chicken breakfast bruschetta', 'Fish breakfast ciabatta', 'Chicken frittata special', 'Fish breakfast special', 'Chicken egg bowl'],
                    American: ['Eggs with chicken sausage', 'Fish omelet', 'Scrambled eggs with salmon', 'Chicken breakfast burrito', 'Egg sandwich with chicken', 'Breakfast bowl with chicken', 'Fish and eggs', 'Chicken breakfast wrap', 'Eggs with goat cheese', 'Chicken hash', 'Egg white omelet with chicken', 'Fish breakfast tacos', 'Chicken and waffles', 'Eggs Benedict with fish', 'Breakfast quesadilla with chicken', 'Chicken sausage scramble', 'Fish breakfast sandwich', 'Chicken frittata', 'Eggs with smoked fish', 'Chicken breakfast pizza', 'Fish and egg bowl', 'Chicken breakfast skillet', 'Egg muffins with chicken', 'Fish breakfast wrap', 'Chicken and eggs', 'Breakfast burrito with fish', 'Chicken shakshuka', 'Fish hash']
                };
                
                const breakfastList = diet === 'Vegetarian' ? vegBreakfasts[cuisine] : meatBreakfasts[cuisine];
                
                const baseRecipes = breakfastList.map((item, i) => ({
                    name: item + (diet === 'Vegetarian' ? ' with whole wheat toast' : ' with whole grains'),
                    calories: calorieBase + (i * 3),
                    protein: proteinBase + (i % 6),
                    source: getSource(cuisine)
                }));
                
                // Merge with custom recipes
                const customKey = cuisine.toLowerCase();
                const dietKey = diet === 'Vegetarian' ? 'vegetarian' : 'meat';
                const customBreakfasts = customRecipes[customKey] && customRecipes[customKey][dietKey] && customRecipes[customKey][dietKey].breakfast 
                    ? customRecipes[customKey][dietKey].breakfast 
                    : [];
                
                return [...baseRecipes, ...customBreakfasts];
            }

            function generateLunchRecipes(cuisine, diet, ageGroup) {
                const calorieBase = ageGroup === 'children' ? 410 : (ageGroup === 'women' ? 440 : (ageGroup === 'men' ? 610 : 500));
                const proteinBase = ageGroup === 'children' ? 15 : (ageGroup === 'women' ? 20 : (ageGroup === 'men' ? 34 : 24));
                
                const vegLunches = {
                    American: ['Grilled cheese sandwich', 'Mac and cheese', 'Bean quesadilla', 'Veggie burger', 'PB&J sandwich', 'Pizza bagels', 'Vegetable fried rice', 'Bean nachos', 'Hummus wrap', 'Minestrone soup', 'Cheese tortellini', 'Veggie spring rolls', 'Black bean burger', 'Veggie pinwheels', 'Veggie pasta salad', 'Bean burrito bowl', 'Cheese ravioli', 'Veggie sub sandwich', 'Tofu stir-fry bowl', 'Vegetable soup', 'Cheese pizza', 'Bean and rice bowl', 'Veggie lo mein', 'Falafel wrap', 'Quinoa salad', 'Veggie tacos', 'Bean chili', 'Veggie sushi'],
                    Mexican: ['Cheese enchiladas', 'Bean burrito', 'Veggie fajitas', 'Cheese quesadilla', 'Bean tostadas', 'Veggie tacos', 'Mexican rice bowl', 'Bean gorditas', 'Veggie sopes', 'Cheese flautas', 'Bean and cheese burrito', 'Veggie torta', 'Mexican salad', 'Bean nachos', 'Veggie chimichanga', 'Cheese tacos', 'Bean taco salad', 'Veggie burrito bowl', 'Mexican bean soup', 'Cheese tamales', 'Veggie enchiladas', 'Bean quesadilla', 'Mexican veggie wrap', 'Cheese sopes', 'Bean and rice plate', 'Veggie tostada', 'Mexican bean bowl', 'Cheese gorditas'],
                    Italian: ['Cheese ravioli', 'Veggie pasta', 'Caprese salad', 'Minestrone soup', 'Pizza margherita', 'Veggie panini', 'Pasta primavera', 'Vegetable risotto', 'Eggplant parmesan', 'Italian bean soup', 'Veggie lasagna', 'Panzanella salad', 'Pasta e fagioli', 'Veggie pizza', 'Tortellini soup', 'Italian veggie wrap', 'Pasta salad', 'Veggie calzone', 'Italian quinoa bowl', 'Veggie piadina', 'Pasta with marinara', 'Italian veggie sandwich', 'Veggie gnocchi', 'Italian bean salad', 'Pasta pomodoro', 'Veggie focaccia sandwich', 'Italian rice bowl', 'Veggie arancini'],
                    Indian: ['Sambar rice with papad', 'Curd rice with pickle', 'Lemon rice with chips', 'Tamarind rice with raita', 'Vegetable biryani with raita', 'Bisi bele bath', 'Tomato rice with appalam', 'Coconut rice with curry', 'Puliyodarai with vadai', 'Avial with rice', 'Thoran with sambar rice', 'Kootu with rice and papad', 'Poriyal with curd rice', 'Rasam rice with fryums', 'Mor kuzhambu with rice', 'Vendakkai puli kulambu', 'Kathirikai gothsu with rice', 'Beans poriyal with sambar', 'Cabbage thoran with rice', 'Erissery with rice', 'Olan with rice', 'Pachadi with meals', 'Keerai masiyal with rice', 'Mixed vegetable sambar', 'Pulissery with rice', 'Moru curry with rice', 'Pumpkin erissery', 'Vegetable stew with appam']
                };
                
                const meatLunches = {
                    American: ['Grilled chicken sandwich', 'Fish sticks with fries', 'Chicken quesadilla', 'Fish burger', 'Chicken wrap', 'Grilled fish sandwich', 'Chicken bowl', 'Fish tacos', 'Chicken salad', 'Fish and chips', 'Chicken pasta', 'Fish wrap', 'Chicken burrito', 'Grilled fish bowl', 'Chicken stir-fry', 'Fish sandwich', 'Chicken sub', 'Fish salad', 'Chicken rice bowl', 'Fish pasta', 'Chicken tacos', 'Grilled fish tacos', 'Chicken Caesar salad', 'Fish rice bowl', 'Chicken noodle soup', 'Fish stir-fry', 'Chicken and rice', 'Fish and vegetables'],
                    Mexican: ['Chicken enchiladas', 'Fish tacos', 'Chicken burrito', 'Fish burrito', 'Chicken fajitas', 'Fish fajitas', 'Chicken quesadilla', 'Fish quesadilla', 'Chicken tostadas', 'Fish tostadas', 'Chicken torta', 'Fish torta', 'Chicken bowl', 'Fish bowl', 'Chicken tacos', 'Grilled fish tacos', 'Chicken nachos', 'Fish nachos', 'Chicken enchilada bowl', 'Fish enchilada bowl', 'Chicken burrito bowl', 'Fish burrito bowl', 'Chicken fajita bowl', 'Fish fajita bowl', 'Chicken chimichanga', 'Fish chimichanga', 'Chicken sopes', 'Fish sopes'],
                    Italian: ['Chicken parmigiana', 'Grilled fish Italian', 'Chicken pasta', 'Fish pasta', 'Chicken panini', 'Fish panini', 'Chicken risotto', 'Fish risotto', 'Chicken cacciatore', 'Fish livornese', 'Chicken scaloppine', 'Fish piccata', 'Chicken lasagna', 'Fish lasagna', 'Chicken pizza', 'Fish pizza', 'Chicken calzone', 'Fish calzone', 'Chicken gnocchi', 'Fish gnocchi', 'Chicken arancini', 'Fish arancini', 'Chicken piadina', 'Fish piadina', 'Chicken focaccia', 'Fish focaccia', 'Chicken sandwich Italian', 'Fish sandwich Italian'],
                    Indian: ['Chicken chettinad with rice', 'Fish curry with rice', 'Chicken biriyani', 'Fish fry with meals', 'Chicken varuval with rice', 'Fish moilee with rice', 'Chicken pepper fry with rice', 'Fish mappas with parotta', 'Chicken curry with rice', 'Fish pollichathu with rice', 'Goat curry with rice', 'Chicken roast with rice', 'Fish Kerala curry', 'Chicken masala with parotta', 'Fish fry Kerala style', 'Goat pepper fry with rice', 'Chicken varutharacha curry', 'Fish molly with rice', 'Chicken sukka with rice', 'Fish peera with rice', 'Goat chukka with rice', 'Chicken peratal with rice', 'Fish mulakittathu', 'Chicken ghee roast', 'Fish curry Tamil style', 'Goat masala with rice', 'Chicken Chettinad biryani', 'Fish fry with tapioca']
                };
                
                const lunchList = diet === 'Vegetarian' ? vegLunches[cuisine] : meatLunches[cuisine];
                
                return lunchList.map((item, i) => ({
                    name: item + ' with vegetables and ' + (diet === 'Vegetarian' ? 'beans' : 'lean protein'),
                    calories: calorieBase + (i * 5),
                    protein: proteinBase + (i % 8),
                    source: getSource(cuisine)
                }));
            }

            function generateDinnerRecipes(cuisine, diet, ageGroup) {
                const calorieBase = ageGroup === 'children' ? 490 : (ageGroup === 'women' ? 480 : (ageGroup === 'men' ? 660 : 560));
                const proteinBase = ageGroup === 'children' ? 18 : (ageGroup === 'women' ? 22 : (ageGroup === 'men' ? 36 : 26));
                
                const vegDinners = {
                    American: ['Veggie pasta primavera', 'Cheese pizza', 'Bean burrito', 'Vegetable lasagna', 'Tofu stir-fry', 'Cheese enchiladas', 'Veggie pot pie', 'Stuffed peppers', 'Vegetable lo mein', 'Eggplant parmesan', 'Bean chili', 'Veggie fajitas', 'Mac and cheese casserole', 'Veggie sushi rolls', 'Quinoa stuffed squash', 'Bean and rice bowl', 'Veggie burger dinner', 'Portobello fajitas', 'Vegetable curry', 'Cheese ravioli', 'Veggie enchilada casserole', 'Black bean tacos', 'Vegetable pad thai', 'Tofu teriyaki', 'Veggie shepherd\'s pie', 'Bean and vegetable stew', 'Veggie risotto', 'Cauliflower steaks'],
                    Mexican: ['Veggie enchiladas', 'Bean and cheese burrito', 'Veggie fajitas', 'Cheese quesadilla dinner', 'Bean tostadas', 'Veggie tacos supreme', 'Mexican bean bowl', 'Cheese chile relleno', 'Veggie burrito bowl', 'Bean and rice plate', 'Veggie tamales', 'Cheese enchilada casserole', 'Bean fajita bowl', 'Veggie chimichanga', 'Mexican veggie pizza', 'Bean and cheese nachos', 'Veggie taco salad', 'Cheese sopes dinner', 'Bean gorditas dinner', 'Veggie tortilla casserole', 'Mexican veggie lasagna', 'Bean and vegetable stew', 'Veggie enchilada stack', 'Cheese stuffed peppers Mexican', 'Bean and rice casserole', 'Veggie Mexican pasta', 'Cheese taco bake', 'Bean and veggie plate'],
                    Italian: ['Vegetable lasagna', 'Eggplant parmesan', 'Pasta primavera', 'Cheese ravioli dinner', 'Veggie pizza dinner', 'Portobello steaks', 'Vegetable risotto', 'Pasta pomodoro', 'Veggie calzone dinner', 'Italian veggie bake', 'Pasta e fagioli', 'Veggie gnocchi', 'Italian bean casserole', 'Pasta with vegetables', 'Veggie parmigiana', 'Italian stuffed peppers', 'Pasta alla norma', 'Veggie arancini dinner', 'Italian veggie stew', 'Pasta with marinara', 'Veggie cannelloni', 'Italian rice bowl dinner', 'Pasta aglio e olio', 'Veggie manicotti', 'Italian vegetable bake', 'Pasta with pesto', 'Veggie Italian casserole', 'Pasta alla puttanesca'],
                    Indian: ['Sambar with rice and poriyal', 'Rasam with rice and fry', 'Vegetable kurma with dosa', 'Avial with rice and papad', 'Kootu with chapati', 'Thoran with rice and curry', 'Pulissery with rice', 'Moru curry with rice', 'Olan with rice', 'Erissery with rice', 'Pachadi with meals', 'Vegetable stew with appam', 'Keerai masiyal with rice', 'Puli kulambu with rice', 'More kulambu with rice', 'Vendakkai sambar', 'Kathirikai curry with rice', 'Beans poriyal meals', 'Mixed vegetable curry Tamil style', 'Ennai kathirikai', 'Vazhakai curry with rice', 'Murungakkai sambar', 'Paruppu usili with rice', 'Cabbage poriyal with dal', 'Carrot beans poriyal', 'Potato roast with sambar', 'Beetroot poriyal with rice', 'Pumpkin curry with rice']
                };
                
                const meatDinners = {
                    American: ['Grilled chicken breast', 'Baked fish fillet', 'Chicken stir-fry', 'Grilled fish tacos', 'Chicken and vegetables', 'Fish and chips healthy', 'Chicken fajitas', 'Grilled fish dinner', 'Chicken pasta', 'Fish with rice', 'Chicken teriyaki', 'Fish piccata', 'Chicken marsala', 'Grilled fish with vegetables', 'Chicken and rice', 'Fish stir-fry', 'Chicken burrito bowl', 'Grilled fish bowl', 'Chicken pot pie', 'Fish dinner special', 'Chicken quesadilla dinner', 'Fish tacos dinner', 'Chicken casserole', 'Fish casserole', 'Chicken and quinoa', 'Fish and quinoa', 'Chicken stew', 'Fish stew'],
                    Mexican: ['Chicken fajitas', 'Fish tacos', 'Chicken enchiladas', 'Fish enchiladas', 'Chicken burrito', 'Fish burrito', 'Chicken quesadilla dinner', 'Fish quesadilla dinner', 'Chicken tostadas', 'Fish tostadas', 'Chicken bowl', 'Fish bowl', 'Chicken tacos', 'Fish tacos special', 'Chicken burrito bowl', 'Fish burrito bowl', 'Chicken enchilada casserole', 'Fish enchilada casserole', 'Chicken fajita bowl', 'Fish fajita bowl', 'Chicken chile relleno', 'Fish chile relleno', 'Chicken tamales', 'Fish tamales', 'Chicken Mexican rice', 'Fish Mexican rice', 'Chicken tortilla casserole', 'Fish tortilla casserole'],
                    Italian: ['Chicken parmigiana', 'Grilled fish Italian', 'Chicken cacciatore', 'Fish livornese', 'Chicken marsala', 'Fish piccata', 'Chicken scaloppine', 'Fish scampi', 'Chicken lasagna', 'Fish lasagna', 'Chicken risotto', 'Fish risotto', 'Chicken pasta', 'Fish pasta', 'Chicken saltimbocca', 'Fish alla griglia', 'Chicken osso buco style', 'Fish Mediterranean', 'Chicken piccata', 'Fish parmigiana', 'Chicken Milanese', 'Fish Milanese', 'Chicken Florentine', 'Fish Florentine', 'Chicken Vesuvio', 'Fish Vesuvio', 'Chicken arrabiata', 'Fish arrabiata'],
                    Indian: ['Chicken chettinad with rice and poriyal', 'Fish curry with rice and thoran', 'Chicken biriyani with raita', 'Fish fry with sambar rice', 'Chicken varuval with rasam rice', 'Fish moilee with appam', 'Chicken pepper fry with rice', 'Fish mappas with parotta', 'Goat curry with rice', 'Chicken roast with rice and poriyal', 'Fish pollichathu with rice', 'Chicken curry Tamil Nadu style', 'Fish Kerala curry with rice', 'Goat pepper fry with parotta', 'Chicken masala with rice', 'Fish fry Kerala style with rice', 'Chicken varutharacha curry', 'Fish molly with puttu', 'Goat chukka with rice', 'Chicken sukka with rice', 'Fish peera with rice', 'Chicken peratal with rice', 'Fish mulakittathu with rice', 'Goat masala with rice', 'Chicken ghee roast with neer dosa', 'Fish curry with tapioca', 'Chicken Chettinad biriyani', 'Fish fry with lemon rice']
                };
                
                const dinnerList = diet === 'Vegetarian' ? vegDinners[cuisine] : meatDinners[cuisine];
                
                return dinnerList.map((item, i) => ({
                    name: item + ' with ' + (cuisine === 'American' ? 'vegetables and whole grains' : (cuisine === 'Mexican' ? 'rice and beans' : (cuisine === 'Italian' ? 'salad and bread' : 'rice and dal'))),
                    calories: calorieBase + (i * 6),
                    protein: proteinBase + (i % 10),
                    source: getSource(cuisine)
                }));
            }

            function generateSnackRecipes(cuisine, diet, ageGroup) {
                const calorieBase = ageGroup === 'children' ? 140 : (ageGroup === 'women' ? 150 : (ageGroup === 'men' ? 210 : 170));
                const proteinBase = ageGroup === 'children' ? 5 : (ageGroup === 'women' ? 8 : (ageGroup === 'men' ? 14 : 9));
                
                const snacks = [
                    'Fruit with nut butter', 'Yogurt with granola', 'Trail mix', 'Smoothie', 'Hummus with veggies',
                    'Cheese and crackers', 'Granola bar', 'Cottage cheese with fruit', 'Pretzels with dip', 'Energy balls',
                    'Protein bar', 'Fruit salad', 'Popcorn', 'Mini muffins', 'Veggie sticks with dip',
                    'Rice cakes with toppings', 'Fruit smoothie', 'Nuts and dried fruit', 'Yogurt tube', 'Apple slices',
                    'String cheese', 'Crackers with spread', 'Fruit and cheese', 'Protein shake', 'Roasted chickpeas',
                    'Banana with nut butter', 'Greek yogurt', 'Mixed nuts'
                ];
                
                return snacks.map((item, i) => ({
                    name: item,
                    calories: calorieBase + (i * 2),
                    protein: proteinBase + (i % 5),
                    source: getSource(cuisine)
                }));
            }

            function getSource(cuisine) {
                const sources = {
                    American: 'Mayo Clinic',
                    Mexican: 'Latino Nutrition Coalition',
                    Italian: 'Mediterranean Diet Foundation',
                    Indian: 'Indian Dietetic Association'
                };
                return sources[cuisine];
            }

            const meals = generateRecipes(state.cuisine, state.diet, state.ageGroup);
            const plan = [];
            
            for (let i = 0; i < state.days; i++) {
                plan.push({
                    day: i + 1,
                    breakfast: meals.breakfast[i],
                    lunch: meals.lunch[i],
                    dinner: meals.dinner[i],
                    snack: meals.snacks[i]
                });
            }

            return {
                plan: plan,
                allRecipes: meals, // Store all recipes for swapping
                source: sources[state.cuisine],
                guidelines: guidelines[state.ageGroup],
                lastUpdated: new Date().toLocaleDateString()
            };
        }

        function displayMealPlan(mealData) {
            const cuisineNames = { indian: 'Indian', mexican: 'Mexican', italian: 'Italian', american: 'American' };
            const ageGroupNames = { 
                children: 'Children (4-12 years)', 
                women: 'Women (30-45 years)', 
                men: 'Men (35-50 years)',
                all: 'All (Family Plan)'
            };
            const dietNames = { 
                vegetarian: 'Vegetarian', 
                meat: 'Meat-Based (Chicken, Fish, Goat)',
                both: 'Both (Mixed - Vegetarian & Meat)'
            };

            document.getElementById('planSummary').innerHTML = `
                <h3>Your ${state.days}-Day Professional Meal Plan</h3>
                <p><strong>${cuisineNames[state.cuisine]}</strong> ‚Ä¢ <strong>${dietNames[state.diet]}</strong></p>
                <p>For <strong>${ageGroupNames[state.ageGroup]}</strong></p>
                <p style="font-size: 14px; margin-top: 12px;">Daily target: ${mealData.guidelines.calories} ‚Ä¢ Protein: ${mealData.guidelines.protein}</p>
                <div class="source-badge"><span>‚úì</span><span>Verified by ${mealData.source}</span></div>
                <p style="font-size: 13px; color: #64748b; margin-top: 8px;">
                    Last updated: ${mealData.lastUpdated} ‚Ä¢ <strong>All ${state.days} days feature unique recipes!</strong>
                </p>
            `;

            let mealPlanHTML = '';
            mealData.plan.forEach(day => {
                const totalCalories = day.breakfast.calories + day.lunch.calories + day.dinner.calories + day.snack.calories;
                const totalProtein = day.breakfast.protein + day.lunch.protein + day.dinner.protein + day.snack.protein;
                
                mealPlanHTML += `
                    <div class="day-card">
                        <div class="day-title">
                            <span>üìÖ</span><span>Day ${day.day}</span>
                            <span style="font-size: 14px; margin-left: auto; color: #059669; font-weight: normal;">
                                ${totalCalories} kcal ‚Ä¢ ${totalProtein}g protein
                            </span>
                        </div>
                        <div class="meal-grid">
                            <div class="meal-item">
                                <div class="meal-label">
                                    <span class="meal-icon">üåÖ</span><span>Breakfast</span>
                                    <span style="margin-left: auto; font-size: 13px; color: #64748b; font-weight: normal;">
                                        ${day.breakfast.calories} kcal
                                    </span>
                                </div>
                                <div class="meal-description">${day.breakfast.name}</div>
                                <div class="meal-source">Source: ${day.breakfast.source}</div>
                                <button class="swap-meal-btn" onclick="openSwapModal(${day.day}, 'breakfast')">üîÑ Swap Meal</button>
                            </div>
                            <div class="meal-item">
                                <div class="meal-label">
                                    <span class="meal-icon">üçΩÔ∏è</span><span>Lunch</span>
                                    <span style="margin-left: auto; font-size: 13px; color: #64748b; font-weight: normal;">
                                        ${day.lunch.calories} kcal
                                    </span>
                                </div>
                                <div class="meal-description">${day.lunch.name}</div>
                                <div class="meal-source">Source: ${day.lunch.source}</div>
                                <button class="swap-meal-btn" onclick="openSwapModal(${day.day}, 'lunch')">üîÑ Swap Meal</button>
                            </div>
                            <div class="meal-item">
                                <div class="meal-label">
                                    <span class="meal-icon">üåô</span><span>Dinner</span>
                                    <span style="margin-left: auto; font-size: 13px; color: #64748b; font-weight: normal;">
                                        ${day.dinner.calories} kcal
                                    </span>
                                </div>
                                <div class="meal-description">${day.dinner.name}</div>
                                <div class="meal-source">Source: ${day.dinner.source}</div>
                                <button class="swap-meal-btn" onclick="openSwapModal(${day.day}, 'dinner')">üîÑ Swap Meal</button>
                            </div>
                            <div class="meal-item">
                                <div class="meal-label">
                                    <span class="meal-icon">ü•§</span><span>Snack</span>
                                    <span style="margin-left: auto; font-size: 13px; color: #64748b; font-weight: normal;">
                                        ${day.snack.calories} kcal
                                    </span>
                                </div>
                                <div class="meal-description">${day.snack.name}</div>
                                <div class="meal-source">Source: ${day.snack.source}</div>
                                <button class="swap-meal-btn" onclick="openSwapModal(${day.day}, 'snack')">üîÑ Swap Meal</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            document.getElementById('mealPlanContainer').innerHTML = mealPlanHTML;
        }

        function generateShoppingList(mealData) {
            const ingredients = {
                'Proteins': new Set(),
                'Vegetables & Fruits': new Set(),
                'Grains & Carbs': new Set(),
                'Dairy & Eggs': new Set(),
                'Pantry Staples': new Set()
            };

            const proteinKeywords = ['chicken', 'fish', 'goat', 'eggs', 'egg', 'tofu', 'lentils', 'beans', 'chickpeas', 'paneer'];
            const veggieKeywords = ['broccoli', 'carrots', 'tomato', 'lettuce', 'spinach', 'peppers', 'onions', 'cucumber', 'asparagus', 'berries', 'banana', 'apple', 'fruit', 'vegetable', 'avocado', 'zucchini', 'eggplant', 'cauliflower', 'squash'];
            const grainKeywords = ['rice', 'pasta', 'bread', 'tortilla', 'quinoa', 'oats', 'cereal', 'wheat', 'noodles', 'naan', 'roti', 'paratha'];
            const dairyKeywords = ['cheese', 'yogurt', 'milk', 'butter', 'ricotta', 'mozzarella', 'parmesan', 'feta', 'cottage cheese'];
            const pantryKeywords = ['beans', 'oil', 'sauce', 'salsa', 'honey', 'nuts', 'seeds', 'hummus', 'peanut butter', 'almond butter', 'tahini', 'pesto'];

            mealData.plan.forEach(day => {
                [day.breakfast, day.lunch, day.dinner, day.snack].forEach(meal => {
                    const mealName = meal.name.toLowerCase();
                    
                    proteinKeywords.forEach(k => {
                        if (mealName.includes(k)) ingredients['Proteins'].add(k.charAt(0).toUpperCase() + k.slice(1));
                    });
                    veggieKeywords.forEach(k => {
                        if (mealName.includes(k)) ingredients['Vegetables & Fruits'].add(k.charAt(0).toUpperCase() + k.slice(1));
                    });
                    grainKeywords.forEach(k => {
                        if (mealName.includes(k)) ingredients['Grains & Carbs'].add(k.charAt(0).toUpperCase() + k.slice(1));
                    });
                    dairyKeywords.forEach(k => {
                        if (mealName.includes(k)) ingredients['Dairy & Eggs'].add(k.charAt(0).toUpperCase() + k.slice(1));
                    });
                    pantryKeywords.forEach(k => {
                        if (mealName.includes(k)) ingredients['Pantry Staples'].add(k.charAt(0).toUpperCase() + k.slice(1));
                    });
                });
            });

            state.shoppingList = ingredients;
            displayShoppingList(ingredients);
        }

        function displayShoppingList(ingredients) {
            const categoryIcons = {
                'Proteins': 'üçñ', 'Vegetables & Fruits': 'ü•¨',
                'Grains & Carbs': 'üåæ', 'Dairy & Eggs': 'ü•õ', 'Pantry Staples': 'üè∫'
            };

            let shoppingHTML = '<h3><span>üõí</span><span>Weekly Shopping List</span></h3>';

            Object.entries(ingredients).forEach(([category, items]) => {
                if (items.size > 0) {
                    shoppingHTML += `
                        <div class="shopping-category">
                            <div class="category-title"><span>${categoryIcons[category]}</span><span>${category}</span></div>
                            <div class="shopping-items">
                    `;
                    Array.from(items).sort().forEach(item => {
                        shoppingHTML += `
                            <div class="shopping-item" onclick="toggleShoppingItem(this)">
                                <div class="shopping-checkbox"></div>
                                <div class="shopping-item-text">${item}</div>
                            </div>
                        `;
                    });
                    shoppingHTML += '</div></div>';
                }
            });

            document.getElementById('shoppingList').innerHTML = shoppingHTML;
        }

        function toggleShoppingItem(element) {
            element.classList.toggle('checked');
            element.querySelector('.shopping-checkbox').classList.toggle('checked');
        }

        function downloadShoppingList() {
            let text = `WEEKLY SHOPPING LIST\nGenerated: ${new Date().toLocaleDateString()}\nMeal Plan: ${state.days} days\nDiet: ${state.diet}\nCuisine: ${state.cuisine}\n\n`;
            Object.entries(state.shoppingList).forEach(([category, items]) => {
                if (items.size > 0) {
                    text += `${category.toUpperCase()}\n`;
                    Array.from(items).sort().forEach(item => text += `‚ñ° ${item}\n`);
                    text += '\n';
                }
            });

            const blob = new Blob([text], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `shopping-list-${state.days}days-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function resetPlanner() {
            state = { cuisine: '', diet: '', ageGroup: '', days: 7, currentStep: 1, mealPlan: null, shoppingList: {}, allRecipes: null };
            document.querySelectorAll('.cuisine-card, .diet-card, .age-group-card').forEach(c => c.classList.remove('selected'));
            document.getElementById('daysSlider').value = 7;
            document.getElementById('daysValue').textContent = '7';
            document.getElementById('calendarViewContainer').style.display = 'none';
            goToStep(1);
        }
        
        // Calendar View Functions
        function toggleCalendarView() {
            const calendarContainer = document.getElementById('calendarViewContainer');
            const toggleBtn = document.getElementById('calendarToggleText');
            
            if (calendarContainer.style.display === 'none') {
                renderCalendarView();
                calendarContainer.style.display = 'block';
                toggleBtn.textContent = 'Hide Calendar View';
            } else {
                calendarContainer.style.display = 'none';
                toggleBtn.textContent = 'Show Calendar View';
            }
        }
        
        function renderCalendarView() {
            const calendarGrid = document.getElementById('calendarGrid');
            let calendarHTML = '';
            
            state.mealPlan.plan.forEach((day) => {
                calendarHTML += `
                    <div class="calendar-day">
                        <div class="calendar-day-header">Day ${day.day}</div>
                        <div class="calendar-meal">
                            <span class="calendar-meal-type">üåÖ Breakfast</span>
                            ${truncateText(day.breakfast.name, 40)}
                        </div>
                        <div class="calendar-meal">
                            <span class="calendar-meal-type">üçΩÔ∏è Lunch</span>
                            ${truncateText(day.lunch.name, 40)}
                        </div>
                        <div class="calendar-meal">
                            <span class="calendar-meal-type">üåô Dinner</span>
                            ${truncateText(day.dinner.name, 40)}
                        </div>
                        <div class="calendar-meal">
                            <span class="calendar-meal-type">ü•§ Snack</span>
                            ${truncateText(day.snack.name, 40)}
                        </div>
                    </div>
                `;
            });
            
            calendarGrid.innerHTML = calendarHTML;
        }
        
        function truncateText(text, maxLength) {
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }
        
        function downloadCalendar() {
            // Create printable calendar view
            const printWindow = window.open('', '_blank');
            const cuisineNames = { indian: 'Indian', mexican: 'Mexican', italian: 'Italian', american: 'American' };
            const ageGroupNames = { 
                children: 'Children (4-12 years)', 
                women: 'Women (30-45 years)', 
                men: 'Men (35-50 years)',
                all: 'All (Family Plan)'
            };
            const dietNames = { 
                vegetarian: 'Vegetarian', 
                meat: 'Meat-Based (Chicken, Fish, Goat)',
                both: 'Both (Mixed - Vegetarian & Meat)'
            };
            
            let calendarHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${state.days}-Day Meal Plan Calendar</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .header h1 { color: #059669; margin-bottom: 10px; }
                        .info { background: #f0fdf4; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
                        .day { border: 2px solid #d1fae5; padding: 10px; border-radius: 8px; page-break-inside: avoid; }
                        .day-header { font-weight: bold; color: #059669; border-bottom: 2px solid #10b981; padding-bottom: 5px; margin-bottom: 10px; }
                        .meal { margin: 8px 0; font-size: 11px; }
                        .meal-type { font-weight: bold; color: #047857; display: block; margin-bottom: 2px; }
                        @media print {
                            .no-print { display: none; }
                            body { padding: 10px; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ü•ó ${state.days}-Day Meal Plan Calendar</h1>
                        <p>${cuisineNames[state.cuisine]} ‚Ä¢ ${dietNames[state.diet]} ‚Ä¢ ${ageGroupNames[state.ageGroup]}</p>
                    </div>
                    <div class="info">
                        <strong>Generated:</strong> ${new Date().toLocaleDateString()} | 
                        <strong>Target:</strong> ${state.mealPlan.guidelines.calories} | 
                        <strong>Protein:</strong> ${state.mealPlan.guidelines.protein}
                    </div>
                    <button class="no-print" onclick="window.print()" style="padding: 10px 20px; background: #059669; color: white; border: none; border-radius: 8px; cursor: pointer; margin-bottom: 20px;">üì• Download PDF</button>
                    <div class="calendar">
            `;
            
            state.mealPlan.plan.forEach((day) => {
                calendarHTML += `
                    <div class="day">
                        <div class="day-header">Day ${day.day}</div>
                        <div class="meal">
                            <span class="meal-type">üåÖ Breakfast</span>
                            ${day.breakfast.name}
                        </div>
                        <div class="meal">
                            <span class="meal-type">üçΩÔ∏è Lunch</span>
                            ${day.lunch.name}
                        </div>
                        <div class="meal">
                            <span class="meal-type">üåô Dinner</span>
                            ${day.dinner.name}
                        </div>
                        <div class="meal">
                            <span class="meal-type">ü•§ Snack</span>
                            ${day.snack.name}
                        </div>
                    </div>
                `;
            });
            
            calendarHTML += `
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(calendarHTML);
            printWindow.document.close();
        }
        
        // Meal Swap Functions
        let currentSwapDay = null;
        let currentSwapMealType = null;
        
        function openSwapModal(dayNumber, mealType) {
            currentSwapDay = dayNumber;
            currentSwapMealType = mealType;
            
            // Get alternative recipes for this meal type
            const mealTypeKey = mealType === 'snack' ? 'snacks' : mealType;
            const allMealsOfType = state.allRecipes[mealTypeKey];
            const currentMeal = state.mealPlan.plan[dayNumber - 1][mealType];
            
            // Filter out the current meal and show alternatives
            const alternatives = allMealsOfType.filter(meal => meal.name !== currentMeal.name).slice(0, 8);
            
            let optionsHTML = `
                <p style="margin-bottom: 16px; color: #64748b;">
                    Currently: <strong>${currentMeal.name}</strong><br>
                    Choose a replacement:
                </p>
            `;
            
            alternatives.forEach((meal, index) => {
                optionsHTML += `
                    <div class="meal-option" onclick="swapMeal(${index})">
                        <div class="meal-option-name">${meal.name}</div>
                        <div class="meal-option-info">
                            ${meal.calories} kcal ‚Ä¢ ${meal.protein}g protein ‚Ä¢ ${meal.source}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('swapOptions').innerHTML = optionsHTML;
            document.getElementById('swapModal').style.display = 'block';
            
            // Store alternatives for swapping
            window.currentAlternatives = alternatives;
        }
        
        function closeSwapModal() {
            document.getElementById('swapModal').style.display = 'none';
            currentSwapDay = null;
            currentSwapMealType = null;
        }
        
        function swapMeal(alternativeIndex) {
            const newMeal = window.currentAlternatives[alternativeIndex];
            
            // Update the meal in the plan
            state.mealPlan.plan[currentSwapDay - 1][currentSwapMealType] = newMeal;
            
            // Re-render the meal plan
            displayMealPlan(state.mealPlan);
            
            // Update calendar if visible
            if (document.getElementById('calendarViewContainer').style.display !== 'none') {
                renderCalendarView();
            }
            
            closeSwapModal();
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('swapModal');
            if (event.target === modal) {
                closeSwapModal();
            }
            const recipeModal = document.getElementById('recipeSuggesterModal');
            if (event.target === recipeModal) {
                closeRecipeSuggester();
            }
        }
        
        // Recipe Suggester Functions
        let customRecipes = {
            indian: { vegetarian: { breakfast: [], lunch: [], dinner: [], snacks: [] }, meat: { breakfast: [], lunch: [], dinner: [], snacks: [] } },
            mexican: { vegetarian: { breakfast: [], lunch: [], dinner: [], snacks: [] }, meat: { breakfast: [], lunch: [], dinner: [], snacks: [] } },
            italian: { vegetarian: { breakfast: [], lunch: [], dinner: [], snacks: [] }, meat: { breakfast: [], lunch: [], dinner: [], snacks: [] } },
            american: { vegetarian: { breakfast: [], lunch: [], dinner: [], snacks: [] }, meat: { breakfast: [], lunch: [], dinner: [], snacks: [] } }
        };
        
        function showRecipeSuggester() {
            document.getElementById('recipeSuggesterModal').style.display = 'block';
            document.getElementById('recipeSuggestions').innerHTML = '';
        }
        
        function closeRecipeSuggester() {
            document.getElementById('recipeSuggesterModal').style.display = 'none';
        }
        
        function generateRecipeSuggestions() {
            const cuisine = document.getElementById('recipeCuisine').value;
            const mealType = document.getElementById('recipeMealType').value;
            const diet = document.getElementById('recipeDiet').value;
            const preferences = document.getElementById('recipePreferences').value;
            
            if (!cuisine || !mealType || !diet) {
                alert('Please fill in all required fields (cuisine, meal type, and diet)');
                return;
            }
            
            // Generate 3-5 recipe suggestions based on inputs
            const suggestions = generateAIRecipeSuggestions(cuisine, mealType, diet, preferences);
            
            displayRecipeSuggestions(suggestions, cuisine, mealType, diet);
        }
        
        function generateAIRecipeSuggestions(cuisine, mealType, diet, preferences) {
            // AI-powered recipe generation based on cuisine, meal type, diet, and preferences
            const suggestions = [];
            const numSuggestions = 3 + Math.floor(Math.random() * 3); // 3-5 suggestions
            
            // Base ingredients by cuisine
            const cuisineIngredients = {
                indian: {
                    vegetarian: ['sambar', 'coconut', 'curry leaves', 'tamarind', 'drumstick', 'snake gourd', 'ash gourd', 'dal', 'rice', 'yogurt', 'mustard seeds', 'urad dal'],
                    meat: ['chicken', 'fish', 'goat', 'coconut', 'curry leaves', 'tamarind', 'pepper', 'coriander']
                },
                mexican: {
                    vegetarian: ['black beans', 'corn', 'peppers', 'avocado', 'cheese', 'tortillas', 'cilantro', 'lime'],
                    meat: ['chicken', 'fish', 'goat', 'shrimp']
                },
                italian: {
                    vegetarian: ['mozzarella', 'tomatoes', 'basil', 'pasta', 'eggplant', 'zucchini', 'ricotta', 'spinach'],
                    meat: ['chicken', 'fish', 'Italian sausage (chicken)', 'anchovies']
                },
                american: {
                    vegetarian: ['avocado', 'eggs', 'cheese', 'quinoa', 'beans', 'sweet potato', 'kale', 'tofu'],
                    meat: ['chicken breast', 'salmon', 'turkey', 'tilapia', 'chicken thighs', 'cod', 'chicken sausage']
                }
            };
            
            // Cooking methods by meal type
            const cookingMethods = {
                breakfast: ['scrambled', 'poached', 'baked', 'toasted', 'grilled'],
                lunch: ['grilled', 'roasted', 'saut√©ed', 'steamed', 'baked'],
                dinner: ['roasted', 'grilled', 'braised', 'curry', 'stir-fried'],
                snack: ['raw', 'baked', 'roasted', 'fresh']
            };
            
            const ingredients = cuisineIngredients[cuisine][diet];
            const methods = cookingMethods[mealType];
            
            // Parse user preferences
            const userPrefs = preferences.toLowerCase().split(',').map(p => p.trim());
            
            for (let i = 0; i < numSuggestions; i++) {
                const ingredient1 = ingredients[Math.floor(Math.random() * ingredients.length)];
                const ingredient2 = ingredients[Math.floor(Math.random() * ingredients.length)];
                const method = methods[Math.floor(Math.random() * methods.length)];
                
                let recipeName = '';
                let recipeDescription = '';
                
                // Generate creative recipe names
                if (mealType === 'breakfast') {
                    recipeName = `${method.charAt(0).toUpperCase() + method.slice(1)} ${ingredient1} with ${ingredient2}`;
                } else if (mealType === 'lunch' || mealType === 'dinner') {
                    recipeName = `${method.charAt(0).toUpperCase() + method.slice(1)} ${ingredient1} and ${ingredient2}`;
                } else {
                    recipeName = `${ingredient1.charAt(0).toUpperCase() + ingredient1.slice(1)} with ${ingredient2}`;
                }
                
                // Add cuisine flair
                if (cuisine === 'mexican') {
                    recipeName += ' with salsa and lime';
                } else if (cuisine === 'italian') {
                    recipeName += ' with herbs and olive oil';
                } else if (cuisine === 'indian') {
                    recipeName += ' with curry leaves and coconut';
                }
                
                // Incorporate user preferences if provided
                if (userPrefs.length > 0 && userPrefs[0] !== '') {
                    const pref = userPrefs[Math.floor(Math.random() * userPrefs.length)];
                    recipeDescription = `Features ${pref} for added flavor. `;
                }
                
                recipeDescription += `A delicious ${cuisine} ${mealType} combining ${ingredient1} and ${ingredient2}. `;
                
                // Generate realistic nutritional values
                const baseCalories = mealType === 'breakfast' ? 350 : (mealType === 'lunch' ? 450 : (mealType === 'dinner' ? 550 : 150));
                const calories = baseCalories + Math.floor(Math.random() * 100) - 50;
                const protein = diet === 'meat' ? 25 + Math.floor(Math.random() * 15) : 15 + Math.floor(Math.random() * 10);
                
                suggestions.push({
                    name: recipeName,
                    description: recipeDescription,
                    calories: calories,
                    protein: protein,
                    source: 'AI-Generated Recipe'
                });
            }
            
            return suggestions;
        }
        
        function displayRecipeSuggestions(suggestions, cuisine, mealType, diet) {
            let html = '<h3 style="margin-top: 24px; margin-bottom: 16px; font-family: Fraunces, serif;">Generated Recipe Suggestions:</h3>';
            
            suggestions.forEach((recipe, index) => {
                html += `
                    <div class="recipe-card">
                        <div class="recipe-card-header">${recipe.name}</div>
                        <div class="recipe-card-content">
                            ${recipe.description}<br>
                            <strong>Nutrition:</strong> ${recipe.calories} kcal ‚Ä¢ ${recipe.protein}g protein
                        </div>
                        <div class="recipe-card-actions">
                            <button class="add-recipe-btn" id="addBtn${index}" onclick="addRecipeToRepository(${index}, '${cuisine}', '${mealType}', '${diet}')">
                                ‚ûï Add to Recipe Library
                            </button>
                        </div>
                        <div id="successMsg${index}" style="display: none;" class="success-message">
                            ‚úÖ Recipe added to your ${cuisine} ${mealType} collection!
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('recipeSuggestions').innerHTML = html;
            
            // Store current suggestions
            window.currentSuggestions = suggestions;
        }
        
        function addRecipeToRepository(index, cuisine, mealType, diet) {
            const recipe = window.currentSuggestions[index];
            const mealTypeKey = mealType === 'snack' ? 'snacks' : mealType;
            
            // Add to custom recipes
            customRecipes[cuisine][diet][mealTypeKey].push(recipe);
            
            // Update button state
            const btn = document.getElementById('addBtn' + index);
            btn.textContent = '‚úì Added';
            btn.classList.add('added');
            btn.disabled = true;
            
            // Show success message
            document.getElementById('successMsg' + index).style.display = 'block';
            
            // Update local storage to persist recipes
            try {
                localStorage.setItem('customRecipes', JSON.stringify(customRecipes));
            } catch (e) {
                console.log('Could not save to localStorage');
            }
        }
        
        // Load custom recipes from localStorage on page load
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const saved = localStorage.getItem('customRecipes');
                if (saved) {
                    customRecipes = JSON.parse(saved);
                }
            } catch (e) {
                console.log('Could not load from localStorage');
            }
            
            // Set default start date to today
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('gcalStartDate')) {
                document.getElementById('gcalStartDate').value = today;
            }
        });
        
        // Google Calendar Export Functions
        function exportToGoogleCalendar() {
            document.getElementById('googleCalendarModal').style.display = 'block';
            document.getElementById('gcalLinks').style.display = 'none';
            
            // Set default start date to today if not set
            const dateInput = document.getElementById('gcalStartDate');
            if (!dateInput.value) {
                dateInput.value = new Date().toISOString().split('T')[0];
            }
        }
        
        function closeGoogleCalendarModal() {
            document.getElementById('googleCalendarModal').style.display = 'none';
        }
        
        function generateGoogleCalendarLinks() {
            const startDateStr = document.getElementById('gcalStartDate').value;
            if (!startDateStr) {
                alert('Please select a start date');
                return;
            }
            
            const startDate = new Date(startDateStr + 'T00:00:00');
            const breakfastTime = document.getElementById('breakfastTime').value;
            const lunchTime = document.getElementById('lunchTime').value;
            const dinnerTime = document.getElementById('dinnerTime').value;
            const snackTime = document.getElementById('snackTime').value;
            const duration = parseInt(document.getElementById('eventDuration').value);
            
            let buttonsHTML = '';
            
            state.mealPlan.plan.forEach((day, index) => {
                const dayDate = new Date(startDate);
                dayDate.setDate(startDate.getDate() + index);
                
                // Create events for all meals
                const meals = [
                    { type: 'Breakfast', time: breakfastTime, meal: day.breakfast, icon: 'üåÖ' },
                    { type: 'Lunch', time: lunchTime, meal: day.lunch, icon: 'üçΩÔ∏è' },
                    { type: 'Dinner', time: dinnerTime, meal: day.dinner, icon: 'üåô' },
                    { type: 'Snack', time: snackTime, meal: day.snack, icon: 'ü•§' }
                ];
                
                // Create a single Google Calendar URL that adds all 4 meals for the day
                const allMealsURL = createGoogleCalendarURL(dayDate, meals, duration);
                
                const dateStr = dayDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                
                buttonsHTML += `
                    <button class="gcal-day-btn" onclick="window.open('${allMealsURL}', '_blank')">
                        <div class="gcal-day-title">üìÖ Day ${day.day} - ${dateStr}</div>
                        <div class="gcal-day-meals">
                            üåÖ ${truncateText(day.breakfast.name, 30)}<br>
                            üçΩÔ∏è ${truncateText(day.lunch.name, 30)}<br>
                            üåô ${truncateText(day.dinner.name, 30)}<br>
                            ü•§ ${truncateText(day.snack.name, 30)}
                        </div>
                    </button>
                `;
            });
            
            document.getElementById('gcalLinkButtons').innerHTML = buttonsHTML;
            document.getElementById('gcalLinks').style.display = 'block';
        }
        
        function createGoogleCalendarURL(date, meals, durationMinutes) {
            // Google Calendar only allows one event per URL, so we'll create URL for first meal
            // and include all meals in the description
            const firstMeal = meals[0];
            const [hours, minutes] = firstMeal.time.split(':');
            
            const startDateTime = new Date(date);
            startDateTime.setHours(parseInt(hours), parseInt(minutes), 0);
            
            const endDateTime = new Date(startDateTime);
            endDateTime.setMinutes(endDateTime.getMinutes() + durationMinutes);
            
            // Format dates for Google Calendar (YYYYMMDDTHHmmss)
            const formatGCalDate = (d) => {
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                const hour = String(d.getHours()).padStart(2, '0');
                const minute = String(d.getMinutes()).padStart(2, '0');
                return `${year}${month}${day}T${hour}${minute}00`;
            };
            
            // Build description with all meals
            let description = 'Daily Meal Plan:\\n\\n';
            meals.forEach(m => {
                description += `${m.icon} ${m.type} (${m.time}):\\n`;
                description += `${m.meal.name}\\n`;
                description += `${m.meal.calories} kcal ‚Ä¢ ${m.meal.protein}g protein\\n`;
                description += `Source: ${m.meal.source}\\n\\n`;
            });
            
            const cuisineNames = { indian: 'Indian', mexican: 'Mexican', italian: 'Italian', american: 'American' };
            const title = `ü•ó Meal Plan - ${cuisineNames[state.cuisine]} Day`;
            
            const params = new URLSearchParams({
                action: 'TEMPLATE',
                text: title,
                dates: `${formatGCalDate(startDateTime)}/${formatGCalDate(endDateTime)}`,
                details: description,
                location: 'Home Kitchen'
            });
            
            return `https://calendar.google.com/calendar/render?${params.toString()}`;
        }
        
        function createICSFile() {
            // Alternative: Create ICS file for download
            const startDateStr = document.getElementById('gcalStartDate').value;
            const startDate = new Date(startDateStr + 'T00:00:00');
            const breakfastTime = document.getElementById('breakfastTime').value;
            const lunchTime = document.getElementById('lunchTime').value;
            const dinnerTime = document.getElementById('dinnerTime').value;
            const snackTime = document.getElementById('snackTime').value;
            const duration = parseInt(document.getElementById('eventDuration').value);
            
            let icsContent = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//AI Meal Planner//EN\n';
            
            state.mealPlan.plan.forEach((day, index) => {
                const dayDate = new Date(startDate);
                dayDate.setDate(startDate.getDate() + index);
                
                const meals = [
                    { type: 'Breakfast', time: breakfastTime, meal: day.breakfast, icon: 'üåÖ' },
                    { type: 'Lunch', time: lunchTime, meal: day.lunch, icon: 'üçΩÔ∏è' },
                    { type: 'Dinner', time: dinnerTime, meal: day.dinner, icon: 'üåô' },
                    { type: 'Snack', time: snackTime, meal: day.snack, icon: 'ü•§' }
                ];
                
                meals.forEach(m => {
                    const [hours, minutes] = m.time.split(':');
                    const startDateTime = new Date(dayDate);
                    startDateTime.setHours(parseInt(hours), parseInt(minutes), 0);
                    
                    const endDateTime = new Date(startDateTime);
                    endDateTime.setMinutes(endDateTime.getMinutes() + duration);
                    
                    const formatICSDate = (d) => {
                        const year = d.getFullYear();
                        const month = String(d.getMonth() + 1).padStart(2, '0');
                        const day = String(d.getDate()).padStart(2, '0');
                        const hour = String(d.getHours()).padStart(2, '0');
                        const minute = String(d.getMinutes()).padStart(2, '0');
                        return `${year}${month}${day}T${hour}${minute}00`;
                    };
                    
                    icsContent += 'BEGIN:VEVENT\n';
                    icsContent += `DTSTART:${formatICSDate(startDateTime)}\n`;
                    icsContent += `DTEND:${formatICSDate(endDateTime)}\n`;
                    icsContent += `SUMMARY:${m.icon} ${m.type} - ${m.meal.name}\n`;
                    icsContent += `DESCRIPTION:${m.meal.calories} kcal ‚Ä¢ ${m.meal.protein}g protein\\nSource: ${m.meal.source}\n`;
                    icsContent += `LOCATION:Home Kitchen\n`;
                    icsContent += 'END:VEVENT\n';
                });
            });
            
            icsContent += 'END:VCALENDAR';
            
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `meal-plan-${startDateStr}.ics`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        // Update window.onclick to handle new modal
        const originalOnClick = window.onclick;
        window.onclick = function(event) {
            const swapModal = document.getElementById('swapModal');
            if (event.target === swapModal) {
                closeSwapModal();
            }
            const recipeModal = document.getElementById('recipeSuggesterModal');
            if (event.target === recipeModal) {
                closeRecipeSuggester();
            }
            const gcalModal = document.getElementById('googleCalendarModal');
            if (event.target === gcalModal) {
                closeGoogleCalendarModal();
            }
        }
    </script>
</body>
</html>
